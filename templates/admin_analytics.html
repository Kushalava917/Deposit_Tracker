{% extends "base.html" %}
{% block content %}

<div class="page-header">
    <h2><i class="bi bi-graph-up-arrow"></i> Analytics Dashboard</h2>
    <p>Overview of investment performance and statistics</p>
</div>

<div class="row g-4 mb-4">
    <div class="col-md-4">
        <div class="stat-card">
            <h3><i class="bi bi-people-fill"></i> Total Users</h3>
            <div class="value">{{ total_users }}</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stat-card" style="background: linear-gradient(135deg, #10b981, #059669);">
            <h3><i class="bi bi-cash-stack"></i> Total Investments</h3>
            <div class="value">₹{{ "{:,.2f}".format(total_investments) }}</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
            <h3><i class="bi bi-percent"></i> Average ROI</h3>
            <div class="value">{{ avg_roi }}%</div>
        </div>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <i class="bi bi-trophy-fill"></i> Projected Maturity Value
    </div>
    <div class="card-body text-center">
        <h3 class="display-4 fw-bold mb-0" style="color: var(--success-color);">
            ₹{{ "{:,.2f}".format(total_maturity) }}
        </h3>
        <p class="text-secondary mt-2">Total expected returns at maturity</p>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <i class="bi bi-bar-chart-fill"></i> Investment vs Maturity Comparison
    </div>
    <div class="card-body">
        <div class="chart-container" style="max-width: 700px;">
            <canvas id="adminChart"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    (function () {
        const canvas = document.getElementById('adminChart');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');

        const chartData = JSON.parse('{{ [total_investments | default(0), total_maturity | default(0)] | tojson }}');

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Total Investment', 'Projected Maturity'],
                datasets: [{
                    label: 'Amount (₹)',
                    data: chartData,
                    backgroundColor: ['#2563eb', '#10b981'],
                    borderRadius: 8,
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        titleFont: {
                            size: 14,
                            family: 'Inter'
                        },
                        bodyFont: {
                            size: 13,
                            family: 'Inter'
                        },
                        callbacks: {
                            label: function (context) {
                                return 'Amount: ₹' + context.parsed.y.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function (value) {
                                return '₹' + value.toLocaleString('en-IN');
                            },
                            font: {
                                family: 'Inter'
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        ticks: {
                            font: {
                                family: 'Inter',
                                weight: '500'
                            }
                        },
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });
    })();
</script>

{% endblock %}